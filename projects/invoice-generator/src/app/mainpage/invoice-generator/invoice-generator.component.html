<div class="bg-white py-6 sm:py-8 lg:py-12">
  <div class="max-w-screen-2xl px-4 md:px-8 mx-auto mt-10">
    <div class="bg-light rounded-lg px-4 py-6 md:py-8 lg:py-12">
      <p class="text-primary lg:text-base font-semibold text-center mb-2 md:mb-3">
        Introducing Billie Invoice Generator
      </p>

      <h2 class="text-gray-800 text-2xl lg:text-3xl font-bold text-center mb-4 md:mb-6">
        Generate your invoice today..
      </h2>

      <p class="max-w-screen-md text-gray-500 md:text-lg text-center mx-auto">Make Invoices. On the Move!</p>
    </div>
  </div>
</div>

<div class="bg-white py-6 sm:py-8 lg:py-12 md:m-10 m-0">
  <div class="max-w-screen-2xl px-1 md:px-8 mx-auto">
    <!-- text - start -->
    <form [formGroup]="invoiceForm" autocomplete="false" (ngSubmit)="onSubmit()" novalidate>
      <!-- text - end -->

      <!-- form - start -->
      <div class="container px-2 md:px-14 py-12 invoice-generator" [ngClass]="isLoggedIn ? '' : 'md:shadow '">
        <div class="md:mb-12 mb-6 flex flex-col md:flex-row gap-1 md:justify-center items-center">
          <h1 class="text-base md:text-2xl font-medium tracking-wide text-primary">Invoice</h1>
          <input
            type="text"
            class="md:text-2xl text-base sm:text-left font-bold w-36 text-gray-700"
            formControlName="invoiceID"
            name=""
            id=""
          />
        </div>

        <div class="addresses">
          <div class="flex flex-col md:flex-row justify-between">
            <div class="w-full md:w-1/2" formGroupName="to">
              <h1 class="mb-4 md:text-base text-sm text-secondary">To</h1>
              <div class="w-full" *ngIf="isLoggedIn">
                <mat-form-field class="w-full md:w-3/4" appearance="outline">
                  <mat-label>Select Customer</mat-label>
                  <mat-select name="food" (selectionChange)="onCustomerChange($event.value)">
                    <mat-option *ngFor="let customer of customers" [value]="customer">
                      <div class="flex m-2 items-center flex-row gap-2">
                        <img
                          *ngIf="customer.customerType === 'Individual'"
                          class="w-7 h-7 rounded-full shadow"
                          [src]="
                            i % 2 == 0
                              ? '../../../assets/icons/ToyFaces_Colored_BG_56.jpg'
                              : '../../../assets/icons/ToyFaces_Colored_BG_29.jpg'
                          "
                          alt=""
                        />
                        <img
                          *ngIf="customer.customerType === 'Organization'"
                          class="w-7 h-7 rounded-full shadow"
                          src="../../../assets/icons/organization1.png"
                          alt=""
                        />
                        <p>{{ customer.name }}</p>
                      </div>
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div class="flex flex-col gap-2">
                <input
                  formControlName="name"
                  type="text"
                  class="text-left w-full md:w-1/2 name-input text-base font-medium text-gray-900"
                  placeholder="Name"
                />
                <input
                  formControlName="address"
                  type="text"
                  class="text-left w-full md:w-1/2 name-input text-base font-medium text-gray-900"
                  placeholder="Address"
                  value="Charuvila puthen veedu "
                />
                <input
                  type="text"
                  formControlName="state"
                  placeholder="State"
                  class="text-left w-full md:w-1/2 name-input text-base font-medium text-gray-900"
                />
                <input
                  type="text"
                  formControlName="country"
                  placeholder="Country"
                  class="text-left w-full md:w-1/2 name-input text-base font-medium text-gray-900"
                />
                <input
                  type="text"
                  formControlName="email"
                  placeholder="Email"
                  class="text-left w-full md:w-1/2 name-input text-base font-medium text-gray-900"
                />
                <input
                  type="text"
                  formControlName="phoneNumber"
                  placeholder="Phone Number"
                  class="text-left w-full md:w-1/2 name-input text-base font-medium text-gray-900"
                />
              </div>
            </div>

            <div class="w-full md:w-1/2" formGroupName="from">
              <div class="flex flex-col md:pt-0 pt-14 md:items-end gap-2">
                <h1 class="mb-4 md:text-base text-sm text-secondary">From</h1>

                <input
                  formControlName="name"
                  type="text"
                  class="md:text-right w-full md:w-1/2 name-input text-base font-medium text-gray-900"
                  placeholder="Name"
                />
                <input
                  formControlName="address"
                  type="text"
                  class="md:text-right w-full md:w-1/2 name-input text-base font-medium text-gray-900"
                  placeholder="Address"
                  value="Charuvila puthen veedu "
                />
                <input
                  type="text"
                  formControlName="state"
                  placeholder="State"
                  class="md:text-right w-full md:w-1/2 name-input text-base font-medium text-gray-900"
                />
                <input
                  type="text"
                  formControlName="country"
                  placeholder="Country"
                  class="md:text-right w-full md:w-1/2 name-input text-base font-medium text-gray-900"
                />
                <input
                  type="text"
                  formControlName="email"
                  placeholder="Email"
                  class="md:text-right w-full md:w-1/2 name-input text-base font-medium text-gray-900"
                />
                <input
                  type="text"
                  formControlName="phoneNumber"
                  placeholder="Phone Number"
                  class="md:text-right w-full md:w-1/2 name-input text-base font-medium text-gray-900"
                />
              </div>
            </div>
          </div>
          <div class="container pt-14 md:overflow-x-hidden overflow-x-auto mx-auto w-full py-0 md:py-4">
            <table class="table-auto w-full whitespace-nowrap" style="border-collapse: separate; border-spacing: 0 1em">
              <thead>
                <tr class="md:p-2 bg-primary shadow rounded-md">
                  <th class="font-normal text-white">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-6 w-6"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="blue"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"
                      />
                    </svg>
                  </th>
                  <th class="md:p-4 whitespace-nowrap font-normal text-white">
                    <div class="flex gap-2">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                        />
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                        />
                      </svg>
                      Services
                    </div>
                  </th>
                  <!-- <th class="md:p-4 whitespace-nowrap font-medium text-white">
                    <div class="flex md:gap-2">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                        />
                      </svg>
                      Description
                    </div>
                  </th> -->
                  <th class="md:p-4 whitespace-nowrap font-medium text-white">
                    <div class="flex gap-2">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"
                        />
                      </svg>
                      Quantity
                    </div>
                  </th>
                  <th class="p-4 whitespace-nowrap font-medium text-white">
                    <div class="flex gap-2">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"
                        />
                      </svg>
                      Price
                    </div>
                  </th>
                  <th class="p-4 whitespace-nowrap font-medium text-white">
                    <div class="flex gap-2">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"
                        />
                      </svg>
                      Action
                    </div>
                  </th>
                </tr>
              </thead>

              <tbody formArrayName="services">
                <tr
                  class="text-gray-700 transition-all transform hover:bg-light duration-500 ease-in-out"
                  *ngFor="let l of invoiceForm.get('services')['controls']; let i = index"
                >
                  <ng-container [formGroupName]="i">
                    <td class="w-6">
                      <input
                        type="text"
                        placeholder="id"
                        formControlName="id"
                        [value]="i + 1"
                        class="w-12 font-semibold"
                      />
                    </td>
                    <td class="mx-auto">
                      <input
                        type="text"
                        placeholder="Service"
                        class="text-gray-500 rounded w-full mx-auto"
                        formControlName="service"
                      />
                    </td>
                    <!-- <td class="">
                      <input
                        type="text"
                        placeholder="Description"
                        class="rounded w-full text-gray-500"
                        formControlName="description"
                      />
                    </td> -->
                    <td class="">
                      <input
                        type="number"
                        placeholder="Quantity"
                        formControlName="quantity"
                        (input)="calculateTotalPrice($event.target.value)"
                        class="font-semibold rounded w-16 text-gray-500"
                      />
                    </td>
                    <td class="">
                      <input
                        type="number"
                        placeholder="Price"
                        class="w-32 text-gray-500 font-semibold"
                        (input)="calculateTotalPrice($event.target.value)"
                        formControlName="price"
                      />
                    </td>
                    <td class="flex justify-center h-full items-center">
                      <svg
                        (click)="removeService(i)"
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6 cursor-pointer"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="red"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                        />
                      </svg>
                    </td>
                  </ng-container>
                </tr>
                <tr></tr>
              </tbody>
            </table>
          </div>
          <div class="flex mb-4 items-center justify-center w-full">
            <svg
              (click)="onAddServices(1)"
              xmlns="http://www.w3.org/2000/svg"
              class="h-8 w-8 cursor-pointer"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="{2}"
                d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
          </div>

          <div *ngIf="invoiceForm.get('services')['controls'].length > 0" class="p-6 hidden md:flex bg-light">
            <span class="flex flex-row gap-32 items-start">
              <div class="tax flex flex-col gap-6 w-48">
                <div class="flex gap-8">
                  <span> Subtotal: </span>
                  <span class="truncate">
                    {{ subTotalCost }}
                  </span>
                </div>
                <div class="flex gap-8">
                  <span> Tax </span>
                  <span class="truncate"> {{ tax }} % </span>
                </div>
              </div>

              <div class="flex flex-col">
                <span>Total </span>
                <span class="font-semibold truncate text-lg">{{ totalCost | currency: currency }}</span>
              </div>
            </span>
          </div>
        </div>
        <div class="w-full min-h-0 rounded-lg mx-auto px-2 py-3">
          <div class="p-6">
            <h3 class="mb-8 font-medium text-xl">Invoice Settings</h3>

            <div class="mb-8 relative w-full">
              <label class="text-sm font-normal" for="Tax">Tax (%)</label>
              <input
                formControlName="tax"
                min="1"
                max="100"
                (input)="valueChange($event.target.value)"
                type="number"
                class="md:w-1/3 w-full input-holder:after border-2 font-semibold"
                placeholder="Tax"
              />
            </div>

            <div class="mb-8 relative w-full">
              <label class="text-sm font-normal" for="Tax">Discount</label>
              <input
                formControlName="discount"
                min="1"
                max="100"
                (change)="discountValueChange($event.target.value)"
                type="number"
                class="md:w-1/3 w-full input-holder:after border-2 font-semibold"
                placeholder="Discount"
              />
            </div>
            <div class="mb-8 relative w-full">
              <label class="text-sm mb-4" for="Tax">Currency</label>

              <select
                (change)="currencyValueChange($event.target.value)"
                class="
                  block
                  md:w-1/3
                  w-full
                  text-secondary
                  py-2
                  px-3
                  border-0
                  bg-light
                  rounded-md
                  focus:outline-none focus:ring-primary-500 focus:border-primary-500
                "
                name="animals"
              >
                <option [value]="currency">
                  {{ currency }}
                </option>
                <option [value]="item" *ngFor="let item of currencyCode">
                  {{ item }}
                </option>
              </select>
            </div>

            <div class="mb-8 relative w-full">
              <label class="text-sm mb-4" for="Tax">Invoice Date</label>

              <div class="w-full">
                <input
                  disabled
                  type="text"
                  formControlName="currentDate"
                  class="
                    block
                    md:w-1/3
                    w-full
                    text-secondary
                    py-2
                    px-3
                    bg-white
                    font-medium
                    focus:outline-none focus:ring-primary-500 focus:border-primary-500
                  "
                />
              </div>
            </div>

            <div class="mb-8 relative w-full">
              <div class="w-full">
                <label class="text-sm mb-4" for="dueDate">Due Date</label>
                <input
                  class="
                    block
                    md:w-1/3
                    w-full
                    text-secondary
                    py-2
                    font-medium
                    px-3
                    bg-white
                    focus:outline-none focus:ring-primary-500 focus:border-primary-500
                  "
                  formControlName="dueDate"
                  type="date"
                />
              </div>
            </div>
            <div class="mb-12 relative w-full">
              <label class="text-gray-500 text-sm mb-4">Amount Due ({{ currency }})</label>
              <h5 class="font-bold text-4xl truncate">
                {{ totalCost | currency: currency }}
              </h5>
            </div>
          </div>
        </div>
        <!-- 
        <div class="flex mb-4 items-center justify-center w-full">
          <h1>Terms and Conditions</h1>
          <svg
            (click)="onAddtermsandconditions(1)"
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8 cursor-pointer"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth="{2}"
              d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
        </div>
        <table class="w-full mb-10" formArrayName="termsandconditions">
          <tr
            class="text-gray-700 w-full transition-all transform hover:bg-light duration-500 ease-in-out"
            *ngFor="let l of invoiceForm.get('termsandconditions')['controls']; let i = index"
          >
            <ng-container [formGroupName]="i">
              <td class="w-6">
                <input type="text" placeholder="id" formControlName="id" class="w-12 font-semibold" />
              </td>

              <td class="">
                <input
                  type="text"
                  placeholder="Description"
                  class="rounded w-full text-gray-500"
                  formControlName="description"
                />
              </td>

              <td class="flex justify-center h-full items-center">
                <svg
                  (click)="removetermsandconditions(i)"
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6 cursor-pointer"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="red"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                  />
                </svg>
              </td>
            </ng-container>
          </tr>
        </table> -->

        <div class="mb-8 relative w-full justify-center flex flex-row flex-wrap gap-5">
          <button
            data-analytics='"Download pdf"'
            class="px-3 py-2 rounded md:w-1/4 md-1/2 text-white font-medium bg-red-500"
            (click)="openPDF()"
          >
            Generate PDF
          </button>
        </div>
      </div>
    </form>
    <!-- form - end -->
  </div>
</div>

<ng-container *ngIf="isLoading">
  <app-loader> </app-loader>
</ng-container>
<iframe #container class="bg-transparent w-full">
  <div></div>
</iframe>
